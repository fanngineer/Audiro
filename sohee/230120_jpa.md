## JPQL이란?

- JPA Query Language
- SQL 쿼리와 유사
- 테이블 대신 엔티티 이름, 속성 사용

```sql
@Entity
public class Review{
	@Id
	@Column(name = "review_id")
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;
	@Column(name = "hotel_id")
	private String hotelId;
}

========================================================
TypedQuery<Review> query = em.createQuery(
		"Select r from Review r where r.hotelId = :hotelId order by r.id desc", // 쿼리
		Review.class); // 결과 타입
query.setParameter("hotelId", "H-001");
List<Review> reviews = query.getResultList(); // 이 시점에 실제 쿼리 실행 -> 결과 반환
```

## 기본 사용법

- select 별칭 from 엔티티명 별칭
- select  별칭 from 엔티티명 as 별칭
- 쿼리 생성
    - TypedQuery<T> EntityManger#createQuery(String ql, Class<T>resultClass)

## 검색 조건 지정

- where + and, or, ( ), 비교 연산자 등 SQL와 비슷하게 사용 가능
    
    ```sql
    // hotelId라는 파라미터를 사용
    select r from Review r where r.hotelId = :hotelId
    // 위치(인덱스) 기반 파라미터 사용
    select r from Review r where r.hotelId = ?
    ```
    
- 파라미터
    - 이름 사용한 경우 :  query.setParameter(”var_name”, “value”)
    - 인덱스 기반 : query.setParameter(0, “value”)
        - 0부터 시작

## 정렬 순서

- order by 사용
- asc, desc 사용
- 여러 기준 사용 가능

## 비교 연산자

- =
- <>
- >, ≥, < , ≤
- between
- in, not in
- like, not like
- is null, is not null

## 페이징 처리

```sql
TypedQuery<Review> query = em.createQuery(
		"Select r from Review r where r.hotelId = :hotelId order by r.id desc", // 쿼리
		Review.class); // 결과 타입
query.setParameter("hotelId", "H-001");
query.setFirstResult(8); // 시작행, 0부터 시작하므로 9번째를 의미
query.setMaxResults(4); // 최대 결과 개수
// 9번째 결과부터 4개를 조회하겠다는 쿼리
List<Review> reviews = query.getResultList();
```

- DB종류에 따라 실제 쿼리는 달라짐
- MySQL은 limit, Oracle은 rownum으로 실행

## 기타 가능한 것들

- 조인
- 집합 함수
    - count, max, min, avg, sum
- group by, having
- 콜렉션 관련 비교
    - member of, not member of, is empty, is not empty
    - exists, all, any
- JPQL 함수
    - concat, substring, trim, abs, sqrt
    - 콜렉션 함수 : size, index 등
    

## JPQL이 아닌 일반 쿼리 사용 고려 상황

- 여러 테이블 조인
    - 레거시 테이블 조인
- DBMS에 특화된 쿼리 필요
    - 오라클 힌트
- 서브 쿼리 필요
- 통계, 대량 데이터 조회/처리

→ 모든걸 JPA로 해결하려 하지 말자..
