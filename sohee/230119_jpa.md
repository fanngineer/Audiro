# @Embeddable 다른 테이블에 매핑하기

- 하나의 엔티티에 @Embeddable을 이용해 값을 들고 있는 다른 객체를 이용 → 근데 이게 다른 테이블일 경우엔?
- 2가지 방법 사용!

## 방법

1. @SecondaryTable + 테이블명

```sql
@Embeddable
public class WriterIntro{
	@Column(table = "writer_intro", name = "content_type")
	private String contentType;

	@Column(table = "write_intro")
	private String content;
	...
}

=============================================================
@Entity
@SecondaryTable(name = "writer_intro",
	pkJoinColumns = @PrimaryKeyJoinColumn(
	name = "writer_id", // writer_intro 테이블 칼럼
	referencedColumnName = "id" // writer 테이블 칼럼
	// 조인 대상을 연결하는 작업
	)
)
public class Writer{
	...
	@Embedded
	private WriterIntro intro;
}
```

1. @SecondaryTable + @AttributeOverride
- 비교적 여러 곳에 사용되는 경우 컬럼에 테이블 이름을 명시하기 어려울 수 있음
- @AttributeOverride를 사용해 해결

```sql
@Embeddable
public class Address{
	@Column(name = "addr1")
	private String address1;

	@Column(name = "addr2")
	private String address2;
	
	@Column(name = "zipcode")
	private String zipcode;
}

=============================================================
@Entity
@SecondaryTables({name = "writer_address",
	pkJoinColumns = @PrimaryKeyJoinColumn(
	name = "writer_id", // writer_intro 테이블 칼럼
	referencedColumnName = "id" // writer 테이블 칼럼
	// 조인 대상을 연결하는 작업
	),
								...
})
public class Writer{
	...
	@Embedded
	@AttributeOverrides({
		@AttributeOverride(name = "address1", column = @Column(table = "writer_address", name = "addr1")),
		@AttributeOverride(name = "address2", column = @Column(table = "writer_address", name = "addr2")),
		@AttributeOverride(name = "zipcode", column = @Column(table = "writer_address")),
	})
	private Address address;
}
```

## 저장

- 각 테이블 별로 INSERT 실행
- null값으로 들어간 값에 대해서는 INSERT를 실행하지 않음

## 조회

- 관련된 테이블을 left join해서 가져옴 → inner join은 존재하지 않을 때 조회가 안되므로,,

## 변경

- 새로운 값 저장
    - 기존 값이 null이 아니면 → update
    - 기존 값이 null이면 → insert
- null 값 저장
    - 기존 값이 null이 아니면 → delete

## 삭제

- 본체 + 매핑된 다른 테이블도 함께 delete

## 정리

- @SecondaryTable
    - 다른 테이블에 저장된 데이터를 @Embeddable로 매핑 가능
    - 다른 테이블에 저장된 데이터가 개념적으로 해당 객체의 값일 때 사용
        - Address 처럼 엔티티라고 하기엔 모호하고 하나의 값을 표현하는 경우
        - 1:1 관계인 두 테이블을 매핑할 때 종종 사용됨